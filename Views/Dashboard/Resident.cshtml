@model CommunalSystem.Models.ResidentDashboardViewModel
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Gyventojo Puslapis";
    <link href="~/css/styles.css" rel="stylesheet" />
}

<div class="dashboard-container">
    @if (!string.IsNullOrEmpty(Model.TempSuccess))
    {
        <div class="success">@Model.TempSuccess</div>
    }
    @if (!string.IsNullOrEmpty(Model.TempError))
    {
        <div class="error">@Model.TempError</div>
    }
    @if (!string.IsNullOrEmpty(Model.Message))
    {
        <div class="info">@Model.Message</div>
    }

    <h1>Gyventojo Puslapis</h1>

    <form asp-controller="Account" asp-action="Logout" method="post">
        @Html.AntiForgeryToken()
        <button type="submit">Logout</button>
    </form>

    @if (!string.IsNullOrEmpty(Model.CommunityName))
    {
        <div class="card">
            <h2>Jūsų bendrija:</h2>
            <p>@Model.CommunityName</p>
        </div>
    }

    <div class="card">
        <h2>Services</h2>
        <form method="post" action="@Url.Action("ViewServices", "Dashboard")">
            <div>
                <label>Search Name:</label>
                <input type="text" name="search" />
            </div>
            <button type="submit">Search</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Paslauga</th>
                    <th>Kaina</th>
                </tr>
            </thead>
            <tbody>
                @inject IHttpContextAccessor HttpContextAccessor

                @foreach (var service in Model.Services.Where(s => s.CommunityId == HttpContextAccessor.HttpContext?.Session.GetInt32("CommunityId")))
                {
                    <tr>
                        <td>@service.ServiceName</td>
                        <td>@service.Price</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
